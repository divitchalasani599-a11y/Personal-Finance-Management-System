from flask import Flask, render_template, request, redirect
from database import init_db, add_transaction, get_transactions
from analytics import generate_summary

app = Flask(__name__)
init_db()

@app.route('/')
def home():
    transactions = get_transactions()
    summary = generate_summary()
    return render_template('index.html', transactions=transactions, summary=summary)

@app.route('/add', methods=['POST'])
def add():
    amount = float(request.form['amount'])
    category = request.form['category']
    type_ = request.form['type']
    add_transaction(amount, category, type_)
    return redirect('/')

if __name__ == '__main__':
    app.run(debug=True)

import sqlite3

def init_db():
    conn = sqlite3.connect("finance.db")
    c = conn.cursor()
    c.execute('''
        CREATE TABLE IF NOT EXISTS transactions (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            amount REAL,
            category TEXT,
            type TEXT
        )
    ''')
    conn.commit()
    conn.close()

def add_transaction(amount, category, type_):
    conn = sqlite3.connect("finance.db")
    c = conn.cursor()
    c.execute("INSERT INTO transactions (amount, category, type) VALUES (?, ?, ?)",
              (amount, category, type_))
    conn.commit()
    conn.close()

def get_transactions():
    conn = sqlite3.connect("finance.db")
    c = conn.cursor()
    c.execute("SELECT * FROM transactions")
    data = c.fetchall()
    conn.close()
    return data

import sqlite3
import pandas as pd
import matplotlib.pyplot as plt

def generate_summary():
    conn = sqlite3.connect("finance.db")
    df = pd.read_sql_query("SELECT * FROM transactions", conn)
    conn.close()

    if df.empty:
        return {"income": 0, "expense": 0}

    income = df[df["type"] == "income"]["amount"].sum()
    expense = df[df["type"] == "expense"]["amount"].sum()

    # Bar chart
    plt.bar(["Income", "Expense"], [income, expense])
    plt.title("Income vs Expense")
    plt.savefig("static/chart.png")
    plt.close()

    return {"income": income, "expense": expense}

<!DOCTYPE html>
<html>
<head>
    <title>Finance Manager</title>
</head>
<body>
    <h1>Personal Finance Manager</h1>

    <form action="/add" method="POST">
        <input type="number" step="0.01" name="amount" placeholder="Amount" required>
        <input type="text" name="category" placeholder="Category" required>
        <select name="type">
            <option value="income">Income</option>
            <option value="expense">Expense</option>
        </select>
        <button type="submit">Add</button>
    </form>

    <h2>Summary</h2>
    <p>Total Income: {{ summary.income }}</p>
    <p>Total Expense: {{ summary.expense }}</p>

    <img src="/static/chart.png" width="400">

    <h2>Transactions</h2>
    <ul>
        {% for t in transactions %}
        <li>{{ t[2] }} - {{ t[1] }} ({{ t[3] }})</li>
        {% endfor %}
    </ul>
</body>
</html>

flask
pandas
matplotlib
